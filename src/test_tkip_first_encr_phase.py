#/usr/bin/python
# -*- coding: utf-8 -*-
'''
Testa le operazioni del modulo tkip_encryptio
OSS: in tutti i test il tsc Ã¨ definito con i byte inversi rispetto al test vector
'''
import sys
sys.path.append('/media/DATA/06-WorkSpace/netsec_wp/src/crypto')
from tkip_encryption import TKIPphaseOne,TKIPvariableSplitter,TKIPphaseTwo,TKIPmixingFunction
import unittest
import struct



class TestTkipEncryptionMixingFunction(unittest.TestCase):
	'''
	Casi di test per le operazioni definite nella classe TKIPphaseOne
	'''


	def test_getSplittedTA(self):
		'''
		testo la funzione che separa il TA
		'''
		tk = 0
		ta = struct.pack('6B',0xaa,0xbb,0xcc,0xdd,0xee,0xff)
		tsc = 0
		variableSplitter = TKIPvariableSplitter(tk,ta,tsc)
		processedResult = variableSplitter.getSplittedTA()
		expectedResult = (0xaa,0xbb,0xcc,0xdd,0xee,0xff)
		self.assertEqual(processedResult,expectedResult) 



	def test_getSplittedTK(self):
		'''
		testo la funzione che separa la TK
		'''
		tk = struct.pack('16B',0x00,0x11,0x22,0x33,0x44,0x55,0x66,0x77,0x88,0x99,0xaa,0xbb,0xcc,0xdd,0xee,0xff)
		ta = 0
		tsc = 0
		variableSplitter = TKIPvariableSplitter(tk,ta,tsc)
		processedResult = variableSplitter.getSplittedTK()
		expectedResult = (0x00,0x11,0x22,0x33,0x44,0x55,0x66,0x77,0x88,0x99,0xaa,0xbb,0xcc,0xdd,0xee,0xff)
		self.assertEqual(processedResult,expectedResult) 



	def test_getSplittedTSC(self):
		'''
		testo la funzione che separa la TSC
		'''
		tk = 0
		ta = 0
		tsc = struct.pack('6B',0x00,0x11,0x22,0x33,0x44,0x55)
		variableSplitter = TKIPvariableSplitter(tk,ta,tsc)
		processedResult = variableSplitter.getSplittedTSC()
		expectedResult = (0x00,0x11,0x22,0x33,0x44,0x55)
		self.assertEqual(processedResult,expectedResult) 

#----------------------------------------------------------------------------------------------------------------

	def test_phaseOne_1(self):
		'''
		testo la classe che effettua la prima parte della mixing function
		'''
		tk = struct.pack('16B',0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0A,0x0B,0x0C,0x0D,0x0E,0x0F)
		ta = struct.pack('6B',0x10,0x22,0x33,0x44,0x55,0x66)
		tsc = struct.pack('6B',0x00,0x00,0x00,0x00,0x00,0x00)
		expectedResult = (0x3DD2,0x016E,0x76F4,0x8697,0xB2E8)
		encrPh1 = TKIPphaseOne(tk,ta,tsc)
		processedResult = encrPh1.getTTAK()
		self.assertEqual(processedResult,expectedResult)



	def test_phaseOne_2(self):
		'''
		testo la classe che effettua la prima parte della mixing function
		'''
		tk = struct.pack('16B',0x63,0x89,0x3B,0x25,0x08,0x40,0xB8,0xAE,0x0B,0xD0,0xFA,0x7E,0x61,0xD2,0x78,0x3E)
		ta = struct.pack('6B',0x64,0xF2,0xEA,0xED,0xDC,0x25)
		tsc = struct.pack('6B',0xFF,0xFF,0x43,0xFD,0xDC,0x20)
		expectedResult = (0x7C67,0x49D7,0x9724,0xB5E9,0xB4F1)
		encrPh1 = TKIPphaseOne(tk,ta,tsc)
		processedResult = encrPh1.getTTAK()
		self.assertEqual(processedResult,expectedResult)


	
	def test_phaseOne_3(self):
		'''
		testo la classe che effettua la prima parte della mixing function
		'''
		tk = struct.pack('16B',0x98,0x3A,0x16,0xEF,0x4F,0xAC,0xB3,0x51,0xAA,0x9E,0xCC,0x27,0x1D,0x73,0x09,0xE2)
		ta = struct.pack('6B',0x50,0x9C,0x4B,0x17,0x27,0xD9)
		tsc = struct.pack('6B',0x8C,0x05,0xFC,0x10,0xA4,0xF0)
		expectedResult = (0xF2DF,0xEBB1,0x88D3,0x5923,0xA07C)
		encrPh1 = TKIPphaseOne(tk,ta,tsc)
		processedResult = encrPh1.getTTAK()
		self.assertEqual(processedResult,expectedResult)



	def test_phaseOne_4(self):
		'''
		testo la classe che effettua la prima parte della mixing function
		'''
		tk = struct.pack('16B',0xC8,0xAD,0xC1,0x6A,0x8B,0x4D,0xDA,0x3B,0x4D,0xD5,0xB6,0x54,0x38,0x35,0x9B,0x05)
		ta = struct.pack('6B',0x94,0x5E,0x24,0x4E,0x4D,0x6E)
		tsc = struct.pack('6B',0XF9,0x30,0xB7,0x73,0x15,0x8B)
		expectedResult = (0xEFF1,0x3F38,0xA364,0x60A9,0x76F3)
		encrPh1 = TKIPphaseOne(tk,ta,tsc)
		processedResult = encrPh1.getTTAK()
		self.assertEqual(processedResult,expectedResult)

#-------------------------------------------------------------------------------------------


	def test_phaseTwo_1(self):
		'''
		testo la classe che effettua la seconda parte della mixing function
		'''
		ttak = (0x3DD2,0x016E,0x76F4,0x8697,0xB2E8)
		tk = struct.pack('16B',0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0A,0x0B,0x0C,0x0D,0x0E,0x0F)
		tsc = struct.pack('6B',0x00,0x00,0x00,0x00,0x00,0x00)
		encrPh2 = TKIPphaseTwo(ttak,tk,tsc)
		processedResult = encrPh2.getWEPSeed()
		expectedResult = (0x00,0x20,0x00,0x33,0xEA,0x8D,0x2F,0x60,0xCA,0x6D,0x13,0x74,0x23,0x4A,0x66,0x0B)
		self.assertEqual(processedResult,expectedResult)



	def test_phaseTwo_3(self):
		'''
		testo la classe che effettua la seconda parte della mixing function
		'''
		ttak = (0x7C67,0x49D7,0x9724,0xB5E9,0xB4F1)
		tk = struct.pack('16B',0x63,0x89,0x3B,0x25,0x08,0x40,0xB8,0xAE,0x0B,0xD0,0xFA,0x7E,0x61,0xD2,0x78,0x3E)
		tsc = struct.pack('6B',0xFF,0xFF,0x43,0xFD,0xDC,0x20)
		encrPh2 = TKIPphaseTwo(ttak,tk,tsc)
		processedResult = encrPh2.getWEPSeed()
		expectedResult = (0xFF,0x7F,0xFF,0x93,0x81,0x0F,0xC6,0xE5,0x8F,0x5D,0xD3,0x26,0x25,0x15,0x44,0xCE)
		self.assertEqual(processedResult,expectedResult)


	
	def test_phaseTwo_5(self):
		'''
		testo la classe che effettua la seconda parte della mixing function
		'''
		ttak = (0xF2DF,0xEBB1,0x88D3,0x5923,0xA07C)
		tk = struct.pack('16B',0x98,0x3A,0x16,0xEF,0x4F,0xAC,0xB3,0x51,0xAA,0x9E,0xCC,0x27,0x1D,0x73,0x09,0xE2)
		tsc = struct.pack('6B',0x8C,0x05,0xFC,0x10,0xA4,0xF0)
		encrPh2 = TKIPphaseTwo(ttak,tk,tsc)
		processedResult = encrPh2.getWEPSeed()		
		expectedResult = (0x05,0x25,0x8C,0xF4,0xD8,0x51,0x52,0xF4,0xD9,0xAF,0x1A,0x64,0xF1,0xD0,0x70,0x21)
		self.assertEqual(processedResult,expectedResult)



	def test_phaseTwo_7(self):
		'''
		testo la classe che effettua la seconda parte della mixing function
		'''
		ttak = (0xEFF1,0x3F38,0xA364,0x60A9,0x76F3)
		tk = struct.pack('16B',0xC8,0xAD,0xC1,0x6A,0x8B,0x4D,0xDA,0x3B,0x4D,0xD5,0xB6,0x54,0x38,0x35,0x9B,0x05)
		tsc = struct.pack('6B',0XF9,0x30,0xB7,0x73,0x15,0x8B)
		encrPh2 = TKIPphaseTwo(ttak,tk,tsc)
		processedResult = encrPh2.getWEPSeed()		
		expectedResult = (0x30,0x30,0xF9,0x31,0x55,0xCE,0x29,0x34,0x37,0xCC,0x76,0x71,0x27,0x16,0xAB,0x8F)
		self.assertEqual(processedResult,expectedResult)
 

#-------------------------------------------------------------------------------------------------------------------------
	
	def test_tkipMixingFunction_1(self):
		'''
		testo la mixing function nella sua interezza
		'''
		tk = struct.pack('16B',0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0A,0x0B,0x0C,0x0D,0x0E,0x0F)
		ta = struct.pack('6B',0x10,0x22,0x33,0x44,0x55,0x66)
		tsc = struct.pack('6B',0x00,0x00,0x00,0x00,0x00,0x00)
		mixingFunction = TKIPmixingFunction(tk,ta,tsc)
		processedWepSeed = mixingFunction.getWepSeed()
		expectedWepSeed = (0x00,0x20,0x00,0x33,0xEA,0x8D,0x2F,0x60,0xCA,0x6D,0x13,0x74,0x23,0x4A,0x66,0x0B)


	def test_tkipMixingFunction_2(self):
		'''
		testo la mixing function nella sua interezza
		'''
		tk = struct.pack('16B',0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0A,0x0B,0x0C,0x0D,0x0E,0x0F)
		ta = struct.pack('6B',0x10,0x22,0x33,0x44,0x55,0x66)
		tsc = struct.pack('6B',0x01,0x00,0x00,0x00,0x00,0x00)
		mixingFunction = TKIPmixingFunction(tk,ta,tsc)
		processedWepSeed = mixingFunction.getWepSeed()
		expectedWepSeed = (0x00,0x20,0x01,0x90,0xFF,0xDC,0x31,0x43,0x89,0xA9,0xD9,0xD0,0x74,0xFD,0x20,0xAA)



	def test_tkipMixingFunction_3(self):
		'''
		testo la mixing function nella sua interezza
		'''
		tk = struct.pack('16B',0x63,0x89,0x3B,0x25,0x08,0x40,0xB8,0xAE,0x0B,0xD0,0xFA,0x7E,0x61,0xD2,0x78,0x3E)
		ta = struct.pack('6B',0x64,0xF2,0xEA,0xED,0xDC,0x25)
		tsc = struct.pack('6B',0xFF,0xFF,0x43,0xFD,0xDC,0x20)
		mixingFunction = TKIPmixingFunction(tk,ta,tsc)
		processedWepSeed = mixingFunction.getWepSeed()
		expectedWepSeed = (0xFF,0x7F,0xFF,0x93,0x81,0x0F,0xC6,0xE5,0x8F,0x5D,0xD3,0x26,0x25,0x15,0x44,0xCE)



	def test_tkipMixingFunction_4(self):
		'''
		testo la mixing function nella sua interezza
		'''
		tk = struct.pack('16B',0x63,0x89,0x3B,0x25,0x08,0x40,0xB8,0xAE,0x0B,0xD0,0xFA,0x7E,0x61,0xD2,0x78,0x3E)
		ta = struct.pack('6B',0x64,0xF2,0xEA,0xED,0xDC,0x25)
		tsc = struct.pack('6B',0x00,0x00,0x43,0xFD,0xDC,0x20)
		mixingFunction = TKIPmixingFunction(tk,ta,tsc)
		processedWepSeed = mixingFunction.getWepSeed()
		expectedWepSeed = (0x00,0x20,0x00,0x49,0x8C,0xA4,0x71,0xFC,0xFB,0xFA,0xA1,0x6E,0x36,0x10,0xF0,0x05)



	def test_tkipMixingFunction_5(self):
		'''
		testo la mixing function nella sua interezza
		'''
		tk = struct.pack('16B',0x98,0x3A,0x16,0xEF,0x4F,0xAC,0xB3,0x51,0xAA,0x9E,0xCC,0x27,0x1D,0x73,0x09,0xE2)
		ta = struct.pack('6B',0x50,0x9C,0x4B,0x17,0x27,0xD9)
		tsc = struct.pack('6B',0x8C,0x05,0xFC,0x10,0xA4,0xF0)
		mixingFunction = TKIPmixingFunction(tk,ta,tsc)
		processedWepSeed = mixingFunction.getWepSeed()
		expectedWepSeed = (0x05,0x25,0x8C,0xF4,0xD8,0x51,0x52,0xF4,0xD9,0xAF,0x1A,0x64,0xF1,0xD0,0x70,0x21)



	def test_tkipMixingFunction_6(self):
		'''
		testo la mixing function nella sua interezza
		'''
		tk = struct.pack('16B',0x98,0x3A,0x16,0xEF,0x4F,0xAC,0xB3,0x51,0xAA,0x9E,0xCC,0x27,0x1D,0x73,0x09,0xE2)
		ta = struct.pack('6B',0x50,0x9C,0x4B,0x17,0x27,0xD9)
		tsc = struct.pack('6B',0x8D,0x05,0xFC,0x10,0xA4,0xF0)
		mixingFunction = TKIPmixingFunction(tk,ta,tsc)
		processedWepSeed = mixingFunction.getWepSeed()
		expectedWepSeed = (0x05,0x25,0x8D,0x09,0xF8,0x15,0x43,0xB7,0x6A,0x59,0x6F,0xC2,0xC6,0x73,0x8B,0x30)



	def test_tkipMixingFunction_7(self):
		'''
		testo la mixing function nella sua interezza
		'''
		tk = struct.pack('16B',0xC8,0xAD,0xC1,0x6A,0x8B,0x4D,0xDA,0x3B,0x4D,0xD5,0xB6,0x54,0x38,0x35,0x9B,0x05)
		ta = struct.pack('6B',0x94,0x5E,0x24,0x4E,0x4D,0x6E)
		tsc = struct.pack('6B',0XF8,0x30,0xB7,0x73,0x15,0x8B)
		mixingFunction = TKIPmixingFunction(tk,ta,tsc)
		processedWepSeed = mixingFunction.getWepSeed()
		expectedWepSeed = (0x30,0x30,0xF8,0x65,0x0D,0xA0,0x73,0xEA,0x61,0x4E,0xA8,0xF4,0x74,0xEE,0x03,0x19)



	def test_tkipMixingFunction_8(self):
		'''
		testo la mixing function nella sua interezza
		'''
		tk = struct.pack('16B',0xC8,0xAD,0xC1,0x6A,0x8B,0x4D,0xDA,0x3B,0x4D,0xD5,0xB6,0x54,0x38,0x35,0x9B,0x05)
		ta = struct.pack('6B',0x94,0x5E,0x24,0x4E,0x4D,0x6E)
		tsc = struct.pack('6B',0XF9,0x30,0xB7,0x73,0x15,0x8B)
		mixingFunction = TKIPmixingFunction(tk,ta,tsc)
		processedWepSeed = mixingFunction.getWepSeed()
		expectedWepSeed = (0x30,0x30,0xF9,0x31,0x55,0xCE,0x29,0x34,0x37,0xCC,0x76,0x71,0x27,0x16,0xAB,0x8F)



if __name__ == '__main__':
	suite = unittest.TestLoader().loadTestsFromTestCase(TestTkipEncryptionMixingFunction)
	unittest.TextTestRunner(verbosity=2).run(suite)
