#/usr/bin/python
# -*- coding: utf-8 -*-

import sys
sys.path.append('../authentication')

from four_way_crypto_utility import keyGenerator,passphraseToPSKMap
import struct

# a partire da passphrase e ssid crea la pmk
passphrase = 'H6x&@!1uLQ*()!12c0x\\f^\'?|s<SNgh-'
SSID = 'WWWLAN'
messaggioPerLaGenerazioneDiChiavi = "Pairwise key expansion"
pskGen = passphraseToPSKMap(passphrase,SSID)
psk = pskGen.getPsk()
print 'PKS = ' + psk.encode("hex")


ANonce = struct.pack('32B',0x5e,0xcb,0x1c,0x8d,0xc1,0x45,0x99,0x3e,0xcc,0xdc,0x7d,0xd1,0x9b,0x1e,0x45,0xfb,0xba,0x26,0x32,0x85,0x1e,0x67,0x95,0xbb,0x83,0xba,0xa1,0x12,0xb9,0x71,0x1e,0x20)
SNonce = struct.pack('32B',0x79,0xf4,0xe8,0x42,0x27,0x0b,0x7f,0x67,0x18,0xd3,0x62,0x77,0xae,0x20,0x8b,0x73,0x99,0xe1,0xa6,0x62,0x12,0x95,0x1a,0xba,0x94,0xfe,0x01,0x26,0x2e,0x52,0x21,0xa7)
AA = struct.pack('6B',00,0x18,0xe7,0x45,0x0e,0x22)
SPA = struct.pack('6B',00,0x19,0xd2,0x4a,0x39,0xb8)

# genero le chiavi
keyGen = keyGenerator(psk,messaggioPerLaGenerazioneDiChiavi,AA,SPA,ANonce,SNonce)
[kck,kek,tk,authenticatorMicKey,supplicantMicKey] = keyGen.getKeys()

print 'TK = ' + tk.encode('hex')

